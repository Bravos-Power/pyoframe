# Migrate to v0.3.0

Pyoframe v0.3.0 comes with several improvements including:

- Support for the [Ipopt](https://coin-or.github.io/Ipopt/) solver
- Clearer error messages that now display the sequence of operations that led to an error
- Clearer debugging outputs where Pyoframe objects are now displayed as tables
- New documentation explaining concepts like [addition modifiers](../concepts/special-functions.md#addition-modifiers)
- API changes for better readability of your optimization models
- And more! 

Unfortunately, these improvements involve some breaking changes. This page will guide you in migrating your code to v0.3.0.

## 1. Discontinue (or rename) submodule imports

Pyoframe's submodules now begin with an underscore to indicate that they are not part of the public API and should not be used:

```python
# from pyoframe.core import Variable  # no longer valid
from pyoframe._core import Variable  # ok, but unstable
from pyoframe import Variable  # good

# also good
import pyoframe as pf

pf.Variable
```

## 2. Use the new `pf.Model(…)` signature

`name` is now a _named-only_ optional parameter of `Model`:

```python
import pyoframe as pf

# pf.Model("my-model")  # invalid in v0.3.0
pf.Model(name="my-model")  # valid
```

`solver` is now the first argument to `Model` so you can simplify your code (optional):

```python
pf.Model(solver="gurobi")  # valid
pf.Model("gurobi")  # also valid!
```

`use_var_names` has been renamed to `solver_uses_variable_names` (to avoid confusion with the new option `print_uses_variable_names`)

```python
# pf.Model(use_var_names=True)  # invalid in v0.3.0
pf.Model(solver_uses_variable_names=True)  # valid
```

See the full [`Model` signature][pyoframe.Model] for details.

## 3. Migrate `pf.sum` and `pf.sum_by`

`pf.sum` and `pf.sum_by` are deprecated. Instead, you should call `.sum` and `.sum_by` directly on Pyoframe objects:

<!-- skip: next -->

```python
pf.sum(m.X)  # deprecated
m.X.sum()  # correct usage in v0.3.0

total_spending_by_city = pf.sum(["day", "hour"], m.X)  # deprecated
total_spending_by_city = m.X.sum("day", "hour")  # correct usage in v0.3.0

# alternatively using .sum_by
total_spending_by_city = pf.sum_by("city", m.X)  # deprecated
total_spending_by_city = m.X.sum_by("city")  # correct usage in v0.3.0
```

If you were using `pf.sum` or `pf.sum_by` on non-Pyoframe objects you'll need to convert the objects to Pyoframe first with `.to_expr()` (or, preferably, apply the summation natively in Pandas or Polars).

## 4. Rename `.add_dim(…)` to `.over(…)`

`add_dim` has been renamed to `over` for clarity:

```python
m = pf.Model()
m.X = pf.Variable()

# m.X.add_dim("time")  # deprecated
m.X.over("time")  # correct usage in v0.3.0
```

The documentation also contains a [new explanation](../concepts/special-functions.md#adding-expressions-with-differing-dimensions-using-over) of `.over(…)` :tada:

## Other breaking changes

- If for some weird reason you were trying to access `model.objective` before having defined the objective, an error will now be raised (prior to v0.3.0 `None` was returned). See the examples under [`model.objective`][pyoframe.Model.objective].

- `ModelElement.unmatched_strategy`, `ModelElement.allowed_new_dims`, `ModelElement.dimensions_unsafe` no longer exist. These were internal variables that should never have been part of the public API. (If you need to access these variables, they are available with an underscore, e.g. `ModelElement._unmatched_strategy`.)

- `.over(…)`, `.keep_unmatched()`, and `.drop_unmatched()` now have a well-defined order of operations. Specifically, they must be applied after all other transforms. For example, `my_obj.drop_unmatched().sum("time")` no longer works because `my_obj.sum("time").drop_unmatched()` should be used instead. Read the documentation to [learn more](../concepts/special-functions.md#addition-modifiers).
